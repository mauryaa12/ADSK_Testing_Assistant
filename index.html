<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Autodesk â€” Multi-Language Link Opener</title>
<style>
  body { font-family: "Segoe UI", Arial, sans-serif; margin: 0; background: #f4f6f8; }
  header {
    background: #0078d4;
    color: white;
    padding: 16px 20px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  }
  header h1 { margin: 0; font-size: 22px; }
  .top-bar {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    margin-top: 12px;
    justify-content: flex-start;
  }
  .quick-link {
    background: #fff;
    color: #0078d4;
    border: 1px solid #0078d4;
    border-radius: 6px;
    padding: 12px 10px;
    cursor: pointer;
    font-weight: 600;
    text-align: center;
    transition: all 0.2s ease;
    width: 200px;
    height: 48px;
    line-height: 24px;
    position: relative;
  }
  .quick-link:hover {
    background: #0078d4;
    color: white;
  }

  /* Dropdown Styling */
  .dropdown {
    display: none;
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    background: white;
    border: 1px solid #0078d4;
    border-radius: 6px;
    box-shadow: 0 3px 8px rgba(0,0,0,0.15);
    z-index: 200;
    width: 200px;
  }
  .dropdown button {
    display: block;
    background: none;
    color: #0078d4;
    border: none;
    padding: 8px 14px;
    width: 100%;
    text-align: left;
    cursor: pointer;
    font-weight: 600;
  }
  .dropdown button:hover {
    background: #e5f0fa;
  }

  /* Main container */
  .container {
    max-width: 900px;
    margin: 30px auto;
    background: #fff;
    padding: 24px;
    border-radius: 10px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  }
  h2 { color: #0078d4; }
  label { display: block; margin-top: 15px; font-weight: bold; }
  input, select {
    width: 100%;
    padding: 8px;
    margin-top: 5px;
    border-radius: 6px;
    border: 1px solid #ccc;
  }
  button {
    padding: 8px 14px;
    border: none;
    background: #0078d4;
    color: white;
    font-weight: bold;
    border-radius: 6px;
    margin-top: 10px;
    cursor: pointer;
  }
  button.secondary {
    background: #e5f0fa;
    color: #0078d4;
    border: 1px solid #0078d4;
  }
  ul { margin-top: 10px; padding-left: 18px; }
  a {
    display: block;
    margin: 5px 0;
    color: #0b5394;
    text-decoration: none;
    word-break: break-all;
  }
  #yearContainer, #manualContainer { display: none; }
  .btn-group { display: flex; gap: 10px; margin-top: 10px; flex-wrap: wrap; }
</style>
</head>
<body>

<header>
  <h1>Autodesk Internal Tools Dashboard</h1>
  <div class="top-bar">
    <button class="quick-link" onclick="openAKN()">ðŸ”— AKN Publisher</button>

    <div class="quick-link" id="flmDropdownBtn" onclick="toggleFLM(event)">ðŸ“Š FLM Dashboard â–¼
      <div class="dropdown" id="flmDropdown">
        <button onclick="openFLM('https://flm-dashboard-stg.autodesk.com/fileUuid')">Staging Dashboard</button>
        <button onclick="openFLM('https://flm-dashboard-prd.autodesk.com/fileUuid')">Production Dashboard</button>
        <button onclick="openFLM('https://flm-dashboard-dev.autodesk.com/fileUuid')">Development Dashboard</button>
      </div>
    </div>

    <button class="quick-link" onclick="openTridion()">ðŸ“š SDL Tridion Docs</button>
    <button class="quick-link" onclick="openJira()">ðŸ§© JIRA</button>
  </div>
</header>

<div class="container">
  <h2>Multi-Language Link Opener</h2>
  <p>Select a product or enter a manual staging link. The tool automatically detects single vs multi-branch release.</p>

  <label>Product</label>
  <select id="productSelect">
    <option value="">-- Select Product or Other --</option>
  </select>

  <div id="yearContainer">
    <label>Release Year</label>
    <select id="yearSelect"></select>
  </div>

  <div id="manualContainer">
    <label>Or Enter Manual Staging Link / Product Name</label>
    <input id="manualInput" placeholder="https://help-staging.autodesk.com/view/NINCAD/2026/ENU/?guid=... OR PLM">
  </div>

  <label>GUID</label>
  <input id="guidInput" placeholder="Enter GUID (e.g. Best_Practices_16)">

  <label>Languages (comma separated)</label>
  <input id="langsInput" placeholder="ENU,DEU,FRA,CHS,ITA,JPN">

  <div class="btn-group">
    <button id="buildStagingBtn">Build Staging Links</button>
    <button id="buildProdBtn" class="secondary">Build Prod Links</button>
    <button id="openAllBtn" class="secondary">Open All</button>
  </div>

  <p id="status" style="color: green;"></p>
  <ul id="linksList"></ul>
</div>

<script>
// Quick Links
function openAKN() { window.open("https://help.autodesk.com", "_blank"); }
function toggleFLM(e) {
  e.stopPropagation();
  const dropdown = document.getElementById("flmDropdown");
  dropdown.style.display = dropdown.style.display === "block" ? "none" : "block";
}
function openFLM(url) {
  if (url) window.open(url, "_blank");
  document.getElementById("flmDropdown").style.display = "none";
}
function openTridion() { window.open("https://tridiondocs-loc.autodesk.com/ISHCM/#app=sc&entry=home", "_blank"); }
function openJira() { window.open("https://jira.autodesk.com/secure/Dashboard.jspa", "_blank"); }

document.addEventListener("click", (e) => {
  const dropdown = document.getElementById("flmDropdown");
  const btn = document.getElementById("flmDropdownBtn");
  if (!btn.contains(e.target)) dropdown.style.display = "none";
});

// Core logic
let productsData = [];
const productSelect = document.getElementById('productSelect');
const yearSelect = document.getElementById('yearSelect');
const yearContainer = document.getElementById('yearContainer');
const manualContainer = document.getElementById('manualContainer');
const manualInput = document.getElementById('manualInput');
const guidInput = document.getElementById('guidInput');
const langsInput = document.getElementById('langsInput');
const buildStagingBtn = document.getElementById('buildStagingBtn');
const buildProdBtn = document.getElementById('buildProdBtn');
const openAllBtn = document.getElementById('openAllBtn');
const linksList = document.getElementById('linksList');
const status = document.getElementById('status');

// Load products.json
fetch('./products.json')
  .then(r => r.json())
  .then(data => { productsData = data; populateProducts(); populateYears(); })
  .catch(() => alert('âŒ Failed to load products.json'));

function populateProducts() {
  productsData.forEach(p => {
    const opt = document.createElement('option');
    opt.value = p.code;
    opt.textContent = `${p.code} â€” ${p.name}`;
    opt.dataset.usesYearBranch = p.usesYearBranch;
    productSelect.appendChild(opt);
  });
  const otherOpt = document.createElement('option');
  otherOpt.value = 'OTHER';
  otherOpt.textContent = 'Other Product (Manual Entry)';
  productSelect.appendChild(otherOpt);
}

function populateYears() {
  for (let y = 2055; y >= 1990; y--) {
    const opt = document.createElement('option');
    opt.value = y;
    opt.textContent = y;
    if (y === 2026) opt.selected = true;
    yearSelect.appendChild(opt);
  }
}

productSelect.addEventListener('change', () => {
  const selected = productSelect.selectedOptions[0];
  if (!selected) return;
  const usesYear = selected.dataset.usesYearBranch === 'true';
  const isOther = selected.value === 'OTHER';
  yearContainer.style.display = usesYear ? 'block' : 'none';
  manualContainer.style.display = isOther ? 'block' : 'none';
  const product = productsData.find(p => p.code === productSelect.value);
  if (product && product.languages) langsInput.value = product.languages.join(',');
  else if (isOther) langsInput.value = '';
});

function handleBuild(env) {
  linksList.innerHTML = '';
  status.textContent = '';
  const productCode = productSelect.value;
  const manual = manualInput.value.trim();
  const guid = guidInput.value.trim();
  const langs = langsInput.value.trim();
  if (!guid) return alert('Please enter a GUID.');
  const langList = langs.split(',').map(l => l.trim().toUpperCase()).filter(Boolean);
  let baseUrl = '';
  let year = null;
  const root = env === 'staging'
    ? 'https://help-staging.autodesk.com/view'
    : 'https://help.autodesk.com/view';
  if (productCode && productCode !== 'OTHER') {
    const selected = productSelect.selectedOptions[0];
    const usesYear = selected.dataset.usesYearBranch === 'true';
    baseUrl = `${root}/${productCode}`;
    if (usesYear) year = yearSelect.value || '2026';
  } else if (manual) {
    const info = analyzeManual(manual);
    if (!info) return alert('Invalid manual input.');
    baseUrl = info.baseUrl.replace('help-staging.autodesk.com', env === 'staging' ? 'help-staging.autodesk.com' : 'help.autodesk.com');
    year = info.year;
  } else return alert('Please select a product or provide a manual link.');
  const urls = buildUrls(baseUrl, langList, guid, year);
  urls.forEach(url => {
    const li = document.createElement('li');
    const a = document.createElement('a');
    a.href = url; a.target = '_blank'; a.textContent = url;
    li.appendChild(a);
    linksList.appendChild(li);
  });
  status.textContent = `âœ… Built ${urls.length} ${env.toUpperCase()} links successfully.`;
}

buildStagingBtn.addEventListener('click', () => handleBuild('staging'));
buildProdBtn.addEventListener('click', () => handleBuild('prod'));

function buildUrls(baseUrl, langs, guid, year) {
  baseUrl = baseUrl.replace(/\/+$/, '');
  const urls = [];
  langs.forEach(lang => {
    urls.push(`${baseUrl}${year ? `/${year}` : ''}/${lang}/?guid=${encodeURIComponent(guid)}`);
  });
  return urls;
}

function analyzeManual(input) {
  try {
    const u = new URL(input);
    const parts = u.pathname.split('/').filter(Boolean);
    const viewIdx = parts.indexOf('view');
    if (viewIdx === -1) return null;
    const afterView = parts.slice(viewIdx + 1);
    const product = afterView[0];
    const year = /^\d{4}$/.test(afterView[1]) ? afterView[1] : null;
    return { baseUrl: `https://help-staging.autodesk.com/view/${product}`, year };
  } catch {
    if (/^[A-Z0-9]+$/i.test(input)) return { baseUrl: `https://help-staging.autodesk.com/view/${input}`, year: null };
    return null;
  }
}

openAllBtn.addEventListener('click', () => {
  const links = document.querySelectorAll('#linksList a');
  if (!links.length) return alert('No links built yet.');
  links.forEach(a => a.click());
});
</script>
</body>
</html>
